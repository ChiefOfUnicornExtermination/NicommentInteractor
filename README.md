# ニコニコ生放送コメント連動API起動スクリプト
ニコニコ生放送でのコメントを取得し、API（特に家庭でのスマートデバイスのコントロール）を呼び出すスクリプトです。
現在のところ簡易版ということで
1. 対象の配信をPCのブラウザで見る
2. →開発者ウィンドウ（F12）を開く
3. →コンソールにスクリプトを全部張り付けてEnter
という使い方のものとなっています。
ファイルはjsファイルですが、実行の際はメモ帳などで開きスクリプトをコピー（もしくはここGitHubのページ上でコピー）後、デバイス部分を上書きしてコンソールに張り付けるだけです。
さすがにこれでは一般利用は厳しいため、サーバー動作版を開発中です。それまでのつなぎ及び各配信者が正式版公開・運用時にどういったことができるのかの思索用のつもりで確認してください。
仕様上はニコニコ動画など生放送でなくても使えると思いますが、意味はないと思います。

スクリプトは @tor4kichi様（ https://qiita.com/tor4kichi ）の「ニコ生配信をアプリで再生」を~~丸パクリ~~参考にさせていただきました。
この場を借りてお礼申し上げます。 
https://qiita.com/tor4kichi/items/5c438aa11fea5422103b 
https://qiita.com/tor4kichi/items/4df5b11ec564bb8f8d16 

スクリプト上部の動作に関する部分がtor4kichi様~~の丸パクリ~~作成のものを参照とした基本動作、そこに受け付けるコメントと各デバイスの設定を下部に追記したものになります。
使用の際はスクリプト上のコメントに従ってご家庭でお使いのスマートデバイスなどの設定に書き換えてください。

動作をテストするためのHTML、張り付けるためのスクリプトを生成するスクリプト…などがあったほうが便利でしょうが（実際私も超簡素なHTMLで試して作りました）、
__そんなところに労力を割くくらいならサーバー動作版をさっさと作るのに力をいれたほうがマシ__…ということで多分作りません。各自で空のHTMLに入れて試しましょう。

## 利用者が修正する場所と構成
```javascript
var devices = new Array(
  {
    deviceid: 1, // デバイス番号。利用目的は忘れました。いらんかも
    devicename: "スマート電球１号", // コマンド受付完了メッセージに表示する対象デバイス名
    isAvailable: true, // デバイス利用可否。設定しておいたデバイスを最終的に使うかどうかをここで切り替えます
    devicenamecandidates: ["電球１", "でんとう"], // 対象デバイスの名称。あいまいなコメントに対応します
    baseUrl: "https://device-control.devicecompany.com/api/v2/", // 対象APIのURL。処理によりURLを書き換えなければならないAPIに対応していないためその場合はその処理を追加してください
    method: "POST", // HTTPメソッド。これも固定を想定していますので変更ある場合は修正してください
    headers: {"header1": "header1value", "header2": "header2value"}, // HTTPヘッダの値。APIに必要なものを設定します。動的な値を指定しなければならない場合はその処理を追加する必要があります。
    requestBody: '{"requestItem": {"method": "X", "value": "1"}}', // HTTPリクエストボディの値です。今のところ{{0}}をコマンド名、{{1}}を値に書き換える処理を入れています。
    commands: { // デバイスに対する処理の指定です。
      command1:{
        keywords:["キーワード１", "キーワード２",..], // 受け付けるキーワードです。実際の処理は別で行い、あくまで「この中にある値が書かれていたら処理を行う指標」です。
        finishMessage: "コマンド１を{{0}}りましたよ？", // 処理完了後のメッセージテンプレートです。処理の戻り値messageで{{0}}を置き換えます
        commandcode: "", // APIに投げるBODYの{{0}}部分の置き換え値
        querystring: [""], // APIのURLにクエリ付与しなければならないこともあるかと思ってたのですが使わなかったので実装してないですね。固定値追加するようにしかなっていないので意味ないですね。必要になったら実装してください。
        handlingfunc: function(device, message){return {value: "", message: "処理ッ！"}} // デバイス情報とユーザーのコメントを受け取り、値とメッセージを並べたオブジェクトを返すメソッドを書いてください。
      },
      command2:{
      }
      ...
    }
  }
);
```
